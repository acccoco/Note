
用一个例子来说明：

### 例子 1

想要得到如下分布的方向角，如何实现：

$$
p(\omega) = \frac{\cos\theta}{\pi}
$$

考虑通过 $\theta,\; \varphi$ 合成。那么问题变成了，$\theta,\; \varphi$ 的概率密度分别为多少。

$\varphi$ 的概率密度很容易得知：

$$p(\varphi) = \frac{1}{\pi}$$

$\theta$ 的概率密度可以通过两个方法得到：

方法 1:

![[图形学/离线渲染/_attachments/Pasted image 20221205203723.png | 300]]

$$
p(\theta)\cdot \Delta \theta = \int_{S}p(\omega) d\omega
=\int_{0}^{2\pi}d\varphi \int_{\theta}^{\theta+\Delta\theta} p(\omega) \sin\theta d\theta
$$

方法 2:

![[图形学/离线渲染/_attachments/Pasted image 20221205204015.png | 200]]

$$
F(\theta) = \int_{S}p(\omega)d\omega
= \int_{0}^{2\pi}d\varphi\int_{0}^{\theta}p(\omega) \sin\theta d\theta
$$

最后可以得到 $\theta$ 的概率密度为：

$$
p(\theta) = 2\sin\theta\cos\theta
$$


### 例 2

在圆锥范围内选择一个方向，要求每个方向概率均等，如何实现？

已知条件有：

![[图形学/离线渲染/_attachments/Pasted image 20221206151256.png | 200]]

可以先以圆锥朝向为中心建立局部坐标系，将问题转化为：在单位球面的 $\theta\in[0,\; \alpha]$ 的范围内均匀地取一点：

![[图形学/离线渲染/_attachments/Pasted image 20221206151908.png |200]]

我们知道，在单位球面上均匀取一点，$z$ 坐标是 uniform 分布的，局部坐标系指定范围内的一点为：

$$
\begin{array}{ll}
z = 1 + r_1 * (\cos\alpha - 1) \\
x = \sin\theta\; \cos\varphi \\
y = \sin\theta\; \sin\varphi \\
其中: \cos\theta = z,\; \varphi = 2\pi * r_2 
\end{array}
$$

最后将局部坐标系转化为世界坐标系即可。
