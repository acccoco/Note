
### 重要性采样
使用「蒙塔卡洛方法」进行数值积分时，理论上来说，最优的概率密度函数是：
$$pdf(x) = \frac{|f(x)|}{\int f(x)dx} $$

这种情况下可以使得方差最小


### GGX 重要性采样
法线分布函数需要满足投影面积的限制，也就是如下的积分等式：
$$\int_{\Omega} D(m) (n \cdot m) d\omega_m  =1$$

> $pdf(m) = D(m) (m \cdot n)$ 


GGX 的法线分布函数形式如下：
$$D(m) = \frac{\alpha^2}{\pi (1 + (m \cdot n)^2 (\alpha^2 - 1))^2}$$

将 GGX 的法线分布函数带入上面的积分等式，可以得到：
$$\int_{\Omega} 
\frac{\alpha^2 \cos\theta \sin\theta}
{\pi (1 + \cos^2\theta (\alpha^2 - 1))^2}d\theta d\varphi = 1$$

要使用蒙塔卡洛方法计算上述积分，最优的 pdf 为：
$$pdf(\theta,\ \varphi) = \frac{\alpha^2 \sin\theta \cos \theta}{\pi(1 + \cos^2\theta (\alpha^2 - 1))^2}$$

然后得到 $\theta$  这个随机变量的：
![[图形学/misc/_attachments/ua8d143df_cdfeLx)=「 pef e(e)de.png | 371]]
或者是等价形式：$\theta = \arctan(\frac{\alpha \sqrt{\xi}}{\sqrt{1-\xi}})$ 

渲染方程的积分变量是 $d\omega_i$ ，上面得到的是 $\rm{pdf}(\omega_m)$ ，需要进行分布变换：
![[图形学/misc/_attachments/u7ebec616_Pasted Graphic.png | 425]]

> 使用「GGX重要性采样」的「逆蒙塔卡洛方法」计算反射方程：
> ![[图形学/misc/_attachments/u19b0a034_Pasted Graphic 1.png | 420]]



### 重要性采样

- chopper：蒙特卡洛积分 [https://zhuanlan.zhihu.com/p/146144853](https://zhuanlan.zhihu.com/p/146144853)：介绍了 Monte Carlo 积分方法，推导了 GGX 重要性采样的表达式
- Sampling microfacet BRDF [https://agraphicsguy.wordpress.com/2015/11/01/sampling-microfacet-brdf/](https://agraphicsguy.wordpress.com/2015/11/01/sampling-microfacet-brdf/) 这篇文章推导了 GGX 重要性采样的表达式
