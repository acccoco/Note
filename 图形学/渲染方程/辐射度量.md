
### 能量
能量是辐射度量学的出发点，一个光子的能量为：
$$Q = \frac{hc}{\lambda}$$
其中：

- $h$  是普朗克常数
- $c$ 是真空中的光速
- $\lambda$  是光的波长


### Flux 通量，功率
Flux 就是单位时间内通过某个表面或区域的能量，单位是 $J/s$  或者 $W$ ：
$$\varPhi = \lim_{\Delta t \to 0} \frac{\Delta Q}{\Delta t} = \frac{dQ}{dt}$$



### Irradiance 辐照度
单位面积接收到的的功率，做辐照度 Irradiance，用 $E$  来表示
单位面积发出的功率，叫做辐射出射度 Radiant Exitance，用 $M$  来表示
单位是 $W/m^2$  或 $J/(m^2 \cdot s)$ ，计算方法如下：
$$E = \lim_{\Delta A\to 0}\frac{\Delta \varPhi}{\Delta A} = \frac{d\varPhi}{d A}$$

> 如何理解$dE(p,\ \omega_i)$ 这个微分，尝试在半球范围内对所有入射方向进行积分，这样就能理解了：
> $$E(p) 
= \int_{H^2}L_i(p,\ \omega_i) \cos\theta_i d\omega_i
= \int_{H^2}dE(p,\ \omega_i) $$
> ![[图形学/渲染方程/_attachments/u4fea653e_dw+.png | 381]]


#### 例子
一个点光源均匀地向四周发光，发光功率 $\varPhi = 500W$ ，则包围球面上的辐照度 $E = \frac{\varPhi}{4\pi r^2}$ ：
![[图形学/渲染方程/_attachments/u4da2c20a_Pasted Graphic.png | 191]]
> 从这个表达式可以看出，距离点光源越远，单位面积接收到的能量就越少，辐照度 $E$  与距离有着**反比平方**的关系。



#### Lambert's Law
有一束光，按照下图的两种方式照射到平面上，计算平面的辐照度 $E$ ：
![[图形学/渲染方程/_attachments/u8c5c920a_Pasted Graphic.png | 240]]

假设光束的功率为 $\varPhi$ 。
第一种情形，平面完全垂直于光束，平面接受光照的面积 $A_1 = A$ ，因此有：
$$E_1 = \frac{\varPhi}{A}$$

第二种情形，平面法向量与光束方向的夹角为 $\theta$ ，平面接受光照的面积 $A_2 = \frac{A}{\cos \theta}$ ，因此有：
$$E_2 = \frac{\varPhi\cos\theta}{A}$$

从上面的例子可以看出，对于同样的光束，平面的方向会影响辐照度，当平面垂直于光束时，辐照度最大。这就是 Lambert's Law


### 立体角
**平面上的角度可以这样定义**：
将物体投影到单位圆上，物体所占的角度即为投影弧长。
![[图形学/渲染方程/_attachments/u46927520_Pasted Graphic.png | 166]]
由于单位圆的周长为 $2\pi$ ，因此整个圆周的角度为 $2\pi\ rad$ 

**空间中的立体角可以这样定义**：
类似于平面角度的定义方法，将物体投影到单位球体上，物体所占的立体角就是投影面积。
![[图形学/渲染方程/_attachments/u35ba07ce_Pasted Graphic.png | 155]]
由于单位球体的总表面积是 $4\pi$ ，因此整个球体的立体角为 $4\pi \ sr$ 

**球坐标系中面积微分对应的立体角为**：
![[图形学/渲染方程/_attachments/u1d44799f_image.png | 243]]
立体角用 $\omega$  表示，面积微分对应的立体角为：
$$d\omega = \frac{dS}{r^2}
= \frac{(rd\theta)(r\sin\theta\ d\varphi)}{r^2} = \sin\theta\ d \theta\ d \varphi$$

> [!info] 如何理解立体角
> 立体角就像面积，$ds=dx*dy$，但是某一点是不存在面积的，只存在坐标$(x,\, y)$



### Intensity 强度
Intensity 表示单位立体角接收或发出的功率，是功率的角密度，用 $I$  表示
$$I = \lim_{\Delta \omega \to 0}\frac{\Delta \varPhi}{\Delta \omega} = \frac{d\varPhi}{d\omega}$$
其中，$\omega$  是立体角。

如果点光源均匀地向四周发出光照，功率为 $\varPhi$ ，那么点光源的 Intensity 为：
$$I = \frac{\varPhi}{4\pi}$$


### Radiance 辐射度
> 这是辐射度量学中最重要的，使用的最多的一个量，因为其他的量都可以通过这个量积分得到。


Irradiance 辐照度给出了某一点处功率的面积密度，但是并未对能量的方向做出区分。
并且根据 Lambert's Law，选择不同的面积方向会得到不同的 Irradiance。

Radiance 的定义为：单位投影面积上，单位立体角接收或者发出的功率。
为什么要强调**投影**面积，为了避免不同的面积选择会导致不同的辐照度 Irrandiance。
$$L(p,\ \omega) 
= \lim_{\Delta \omega\to 0}\frac{\Delta E_{\omega}(p)}{\Delta \omega} 
= \frac{d E_{\omega}(p)}{d\omega}$$

这里的 $E_{\omega}(p)$  就是在 $p$  点周围，与光线**垂直**的平面上测得的。

Irradiance，Indensity 和 Radiance 的示意图：
![[图形学/渲染方程/_attachments/uf4df4a3b_dA.png | 358]]


### 常见情形

#### 理解 Radiance
光源发出的 Radiance 为 $L_o(p_2,\ \omega)$ ，物体某一点处接收到的 Radiance 为多少 $L_i(p_1,\ \omega)$ ？
![[图形学/渲染方程/_attachments/ub383c5fa_Pasted Graphic.png | 261]]

设光源上的点到物体上的点的距离为 $r$ 

以光源为中心，物体的面积微分 $dA_1$ 所占的立体角为 $d\omega_1 = \frac{dA_1 \cos \theta_1}{r^2}$ 
那么光源从点 $p_2$  周围，面积 $dA_2$ 发出的， $\omega$  方向立体角大小为 $d\omega_1$ 的功率为：
![[图形学/渲染方程/_attachments/u742a1cf0_lioght surtace.png | 191]]
$$\varPhi_o = L_o(p_2,\ \omega) \cdot dA_2 \cos \theta_2\cdot \frac{dA_1 \cos\theta_1}{r^2}$$

以物体为中心，光源的面积微分 $dA_2$  所占的立体角为 $d\omega_2 = \frac{dA_2 \cos\theta_2}{r^2}$ 
那么物体在点 $p_1$  周围，面积 $dA_1$  上接收到的，来自 $\omega$  方向的，立体角大小为 $d\omega_2$  的功率为：
![[图形学/渲染方程/_attachments/u30dbfe56_Pasted Graphic 1.png | 219]]
$$\varPhi_i = L_i(p_1,\ \omega) \cdot
dA_1 \cos\theta_1 \cdot
\frac{dA_2 \cos\theta_2}{r^2}$$

建立方程 $\varPhi_o = \varPhi_i$ ，可以得到：
$$L_i(p_1,\ \omega) = L_o(p_2,\ \omega)$$

> 这可以看出，对于同一束光，光源发出的 Radiance 和物体接收到的 Radiance 是一样的，无论光源和物体位于何处。
> 可以将 $L(p,\ \omega)$ 理解为一束光线的属性



#### 关于面积积分
面光源照射到物体，求物体某一处的 Irradiance 辐照度 $E$ 。面光源在点 $p$  处 $\omega$  方向的 Radiance 为 $L(p,\ \omega)$ 。
![[图形学/渲染方程/_attachments/u3ac5fc7e_Pasted Graphic.png | 239]]
物体在面积 $dA_1 $  上接收到的，来自于光源上面积为 $dA_2$  的光照功率为：
$$d\varPhi = L(p,\ \omega) 
\cdot dA_2 \cos\theta_2
\cdot \frac{dA_1 \cos\theta_1}{r^2}$$
其中：

- $\frac{dA_1\cos\theta_1}{r^2}$  表示以光源上的 $p$  点为中心，物体面积 $dA_1$  对应的立体角。

对整个面光源进行面积积分，得到物体在面积 $dA_1$  上总的接收功率 $\varPhi$ ，最后除以物体的面积 $dA_1$ ，得到物体在该点处的 Irradiance：
$$E = 
\frac{\int_A d\Phi}{dA_1} =
\int_{A}
\frac{L(p,\ \omega) \cos\theta_1 \cos\theta_2}{r^2}dA_2$$
其中：

- $A$  是整个光源的面积
- $L(p,\ \omega)$  是光源在 $p$  点处，$\omega$  方向的 Radiance
- $r$  是光源上的 $p$  点到物体上点的距离  


#### 半球方向上积分
已知物体上 $p$  点处接收到的来自 $\omega$ 方向的 Radiance 为 $L(p,\ \omega)$ ，求物体在 $p$  点处的 Irraiance 辐照度 $E$ 。
![[图形学/渲染方程/_attachments/u784138d9_Pasted Graphic.png | 239]]
物体在 $p$  点处面积 $dA$  上接收到的，来自 $\omega$  方向的立体角为 $d\omega$  的功率为：
$$d\varPhi = L(p,\ \omega) \cdot dA\cos\theta\cdot d\omega$$

以物体法线为 $z$  轴，以 $p$  为原点，建立坐标系，在半球范围内进行积分，可以得到物体在 $p$  点处面积 $dA$  上接收到的总功率 $\varPhi$ ，最后除以物体的面积 $dA$  就能得到物体在 $p$  点处的 Irradiance 辐照度：
$$E = \int_{H} L(p,\ \omega) \cos\theta\ d\omega 
= \int_{0}^{2\pi} \int_{0}^{\pi/2} L(p,\ \theta,\ \varphi)\cos \theta \sin \theta d\theta d\varphi$$

注：在球坐标系中 $d\omega = \sin\theta\ d\theta d\varphi$ 








