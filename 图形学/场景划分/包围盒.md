
### AABB
AABB，Axis-Aligned Bounding Box，轴对齐包围盒
![[图形学/场景划分/_attachments/G0u7q_image.png | 173]]

包围盒的表示方法：
```cpp
struct AABB {
	vec3 min;
	vec3 max;
};
```


#### 构建包围盒
不需要关心物体的形状，只需要不断地为包围盒增加新的顶点即可：
```cpp
void AABB::join(const vec3 &point)
{
    this->min = vec3{min(point.x, min.x), ...};
    this->max = vec3{max(point.x, max.x), ...};
}
```


#### 光线和 AABB 的交点
基本思路：分别求出光线与包围盒的三对平面相交的线段，然后取他们的交集。
![[图形学/场景划分/_attachments/u8df170c8_X+.png | 431]]

注：三维的 AABB 需要特别考虑三角形和包围盒边界重合的问题。


#### AABB 的碰撞检测
只有当所有投影方向都相交时，两个 AABB 才相交。
![[图形学/场景划分/_attachments/uf32cb3f3_Pasted Graphic 3.png | 244]]


### OBB
`Oriented bounding box`
OBB 是长方体，AABB 是特殊的 OBB（轴对齐的）
各种包围体的示意图：
![[图形学/场景划分/_attachments/u18d4649e_image.png | 377]]


#### 构建 OBB
利用协方差矩阵计算出 OBB 的主方向。
主方向下的 AABB，即为原坐标系下的 OBB。
![[图形学/场景划分/_attachments/ua91fb946_image.png | 504]]


#### 判断相交
基本方法是「分离轴定理」：如果存在一个平面将两个物体分开，则两个物体不相交。
![[图形学/场景划分/_attachments/ubc75c20d_image.png | 222]]

**二维情况下**，只需要判断 4 个轴的投影是否都相交即可：
![[图形学/场景划分/_attachments/u87c2ff66_Pasted Graphic 4.png | 146]]

**三维情形下**，需要一共判断 15 个轴的投影是否都发生相交：
参考：
下图中，虽然在 6 个轴上的投影都有相交，但 OBB 实际并不相交：
![[图形学/场景划分/_attachments/ub24b3e00_image.png | 253]]


### 包围球

#### 包围球的合并方法
连接两个包围球的球心，新的包围球球心位于连线上：
![[图形学/场景划分/_attachments/ubb227ab1_Pasted Graphic 2.png | 181]]


#### 构建包围球
**均值法**：
（算法简单，速度快，但不紧凑）
以所有点的坐标均值作为球心，到球心的最长距离作为半径：
![[图形学/场景划分/_attachments/ud7536b38_Pasted Graphic.png | 223]]

**Ritter 方法**：
（**不是**紧凑的，但效果较好）
构建步骤：

- 找到一个点 `A`，在模型中寻找距离 `A`最远的点 `B`
- 在模型中寻找距离 `B`最远的点 `C`
- 线段 `BC`就是球的初始直径
- 遍历模型的所有顶点，如果顶点不在包围球中，就扩展包围球，容纳这个顶点。

![[图形学/场景划分/_attachments/ucb5299e3_Pasted Graphic 1.png | 240]]


### 凸多边形
如何判断一个点是否在多边形之内：
![[图形学/场景划分/_attachments/uf9638088_image.png | 216]]
叉积的符号都相同
![[图形学/场景划分/_attachments/uc0c633ef_image.png | 199]]
叉积的符号不完全相同


### 参考

- [3D空间包围球(Bounding Sphere)的求法 - mfrbuaa - 博客园](https://www.cnblogs.com/mfrbuaa/p/3811847.html)
- [https://en.wikipedia.org/wiki/Bounding_sphere](https://en.wikipedia.org/wiki/Bounding_sphere)
- [碰撞检测算法之分离轴定理](https://zhuanlan.zhihu.com/p/508874496)
- [主成分分析法（PCA方法）计算OBB包围盒_averagePerson的博客-CSDN博客_obb包围盒计算](https://blog.csdn.net/averagePerson/article/details/123911265)
- [3D Oriented bounding boxes made simple](https://logicatcore.github.io/scratchpad/lidar/sensor-fusion/jupyter/2021/04/20/3D-Oriented-Bounding-Box.html)
