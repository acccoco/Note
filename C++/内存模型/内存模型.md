### 为什么需要关心内存模型

内存一致性模型 memory consistency model，又叫内存模型。通过内存模型可以知道，什么情况下会发生 reordering。

> [!note] memory model 的解释
> A memory model, or memory consistency model, for a programming language describes how threads in a parallel processing system can access shared data and synchronize with each other, while allowing compilers and hardware the freedom to reorder and optimize memory accesses. This is achieved by precisely specifying where and how instructions and memory operations can be reordered, and in what order the effects of those memory operations can become visible to other threads.


> [!note] 为什么需要关心内存模型，引用 [Linux Document/memory-barriers](https://github.com/torvalds/linux/blob/master/Documentation/memory-barriers.txt) 中的一段话：
> Such enforcement is important because the CPUs and other devices in a systemcan use a variety of tricks to improve performance, including reordering,deferral and combination of memory operations; speculative loads; speculativebranch prediction and various types of caching.  Memory barriers are used tooverride or suppress these tricks, allowing the code to sanely control theinteraction of multiple CPUs and/or devices.


硬件需要给软件提供内存一致性模型，用来告诉软件，什么情况下会发生 reorder。
语言是多个硬件系统的抽象，语言需要给 programmer 提供内存一致性模型，告诉 programmer，什么情况下会发生 reorder（编译器的，或者硬件的）

### 硬件的内存一致性模型
内存一致性模型，store buffer，barrier 的**优秀**介绍：
https://www.cs.utexas.edu/~bornholt/post/memory-models.html

### 操作系统的内存一致性模型
linux 源代码中给出的内存一致性模型的介绍：**这一篇太低层了，只看了一部分**。
https://github.com/torvalds/linux/blob/master/Documentation/memory-barriers.txt


### C++ 的内存模型
**gcc **给出的内存模型的介绍：
https://gcc.gnu.org/wiki/Atomic/GCCMM/AtomicSync


preshing 的一系列文章：2011年 - 2015 年的：
[Preshing on Programming](https://preshing.com/archives/)
