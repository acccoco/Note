> 如何理解总方差定律：总方差定律描述了「局部方差」和「总体方差」之间的关系，给出了根据**局部方差**得到**总体方差**的办法。


### 总方差定律
首先，$var(X|Y)$  是一个随机变量，可以看作 $h(Y)$ 。

总期望定律如下：
$$var(X) = E[var(X|Y)] + var(E[X|Y])$$

证明过程（抽象，和直觉无关）：
![[不活跃主题/概率论/期望与方差/_attachments/1644639519789-03312598-ff60-4194-85c6-8d40aa33ea0d.png | 427]]

### 例子：理解总方差定律
通过以下例子来理解「总方差定律」：
> 随机变量 $X$  表示学生的分数，$Y$  表示课号。
> $Y=1$  的课有 $10$  名学生，平均分为 $90$ ，即 $E[X|Y=1]=90$ ；$Y=2$  的课程有 $20$  名学生，平均分为 $60$ ，即$E[X|Y=2]=60$ ；
> 在 $Y =1$  的课程中，学生分数的方差为 $var(X|Y=1) = 10$ ；在 $Y=2$  的课程中，学生分数的方差为 $var(X|Y=2)=20$ ；
> 求 $var(X)$  


解：
现在考虑 $var(X|Y)$ ，它是一个和 $Y$  有关的随机变量，如下：
$$var(X|Y) = 
\left\{\begin{array}{lll}
10, \quad Y=1;\ P=1/3 \\
20, \quad Y=2;\ P=2/3
\end{array}\right.$$

再考虑 $E[X|Y]$ ，它是一个和 $Y$  有关的随机变量，如下：
$$E[X|Y] = 
\left\{\begin{array}{lll}
90, \quad Y=1;\ P=1/3 \\
60, \quad Y=2;\ P=2/3
\end{array}\right.$$

使用总方差定律计算 $X$  的方差：
$$var(X) = E[var(X|Y)] + var(E[X|Y])$$

这个公式意味着什么：

- 首先将所有学生划分为两个部分，上 $Y=1$  的课的学生和上 $Y=2$  的课的学生；
- $E[var(X|Y)]$  考虑了每一部分内的方差
- $var(E[X|Y])$  考虑了两个部分之间的方差
- 最后将上述考虑加在一起，就是总体的方差


### 例子：使用总方差定律
求 $var(X)$ ，随机变量的 PDF 如下所示：
![[不活跃主题/概率论/期望与方差/_attachments/1644821427173-fbddf3c9-06b1-4c80-81fe-ce1a4ca7edc4.png | 217]]

解：
定义一个随机变量 $Y$ ，当 $X\in [0,\ 1]$  时，$Y=1$ ；当 $X\in[1,\ 2]$  时，$Y=2$ ；
![[不活跃主题/概率论/期望与方差/_attachments/1644823293681-a23b739d-aa82-492e-8258-f181fd3f4fdd.png | 370]]


