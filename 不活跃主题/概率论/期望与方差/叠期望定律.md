> 条件随机变量的期望也是一个随机变量，且是 $Y$  的函数：
> $$E[X|Y] = g(Y)$$
> 
> 叠期望定律可以这样理解：「部分均值」和「总体均值」之间的关系。



### 折断棍子的试验
试验如下：
> 有一根长度为 $l$  的棍子，随机选择一个位置 $Y$  来折断它，然后在剩余部分中再随机选择一个位置 $X$  来折断。
> ![[不活跃主题/概率论/期望与方差/_attachments/1643033093948-742c77fe-9625-4d14-9cd9-4113d804bc1f.png | 204]]
> 求 $E[X]$  


如果已知第一次的折断位置 $Y$ ，那么第二次折断位置的期望为：
$$E[X|Y=y] = \int_{0}^{y}x\cdot f_{X|Y}(x|y)\ dx
$$

其中，$X|Y=y$  的 PDF 如下图：
![[不活跃主题/概率论/期望与方差/_attachments/1643033094036-d9865ec0-f01f-4433-9a6c-e8d9b162f57d.png | 168]]

因此，$E[X|Y=y] = y/2$ 。
如果第一次折断的位置 $Y$  是一个未知数，那么第二次折断位置的期望为：
$$E[X|Y] = \frac{Y}{2}
$$

也就是说，条件随机变量的期望也是一个「随机变量」，这个随机变量是 $Y$  的函数。


### 叠期望定律
叠期望定理（the Law of Iterated Expectation）如下：
$E[E[X|Y]] = E[X]$  

即：随机变量条件期望的期望，是随机变量的期望本身。
这可以视为「**期望的全概率公式**」。

由于：

- $E[X]$  是一个**常数**
- $E[X|Y]$  是一个**随机变量**，这个随机变量是 $Y$  的函数，即：$E[X|Y]=g(Y)$ 。
- $E[E[X|Y]] = E[g(Y)]$  是一个常数，在离散的情形下可以如下计算：

![[不活跃主题/概率论/期望与方差/_attachments/1644571180298-e2c7a548-710d-41f7-9ba5-d96de88f76c6.png | 343]]

简单来说，就是：
$$E[X] = P(Y_1)\cdot E[X|Y_1] + P(Y_2) \cdot E[X|Y_2] + \cdots$$

**叠期望定理的应用**：
求经过两次这段后剩余木棍长度的期望 $E[X]$ ：
$$E[X] = E[E[X|Y]] = E[Y/2] = l/4$$


