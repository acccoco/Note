## <b style="color:blue;">ğŸ“çº¿æ®µæ ‘</b>

#### <b style="color:darkblue;">ğŸ“çº¿æ®µæ ‘çš„ç»“æ„</b>

çº¿æ®µæ ‘æ“…é•¿<span style="background:yellow;">åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢</span>

æ³¨æ„ï¼šä¸‹æ ‡ä»1å¼€å§‹

![[ä¸æ´»è·ƒä¸»é¢˜/æ•°æ®ç»“æ„ä¸ç®—æ³•/æŸ¥æ‰¾/_attachments/Pasted image 20221101022508.png]]

#### <b style="color:darkblue;">ğŸ“çº¿æ®µæ ‘çš„æ“ä½œ</b>

æ³¨æ„

- åœ¨åŒºé—´ä¿®æ”¹æ—¶ä½¿ç”¨`lazy`æ ‡è®°ï¼Œå¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™ä½ä¸º$O(logn)$ã€‚
- `lazy`æ ‡è®°è¡¨ç¤ºåŒºé—´å†…çš„æ‰€æœ‰`A[n]`å…ƒç´ éƒ½å¢åŠ ä¸€ä¸ªå€¼ã€‚
- ç”±äºä½¿ç”¨äº†`lazy`æ ‡è®°å»¶è¿Ÿæ›´æ–°ï¼Œæ‰€ä»¥ä¸ç”¨å†ç»´æŠ¤åŸ`A[n]`æ•°ç»„

`PushUp()`ï¼šæ ¹æ®å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹çš„å€¼

`PushDown()`ï¼šä¸‹æ¨`lazy`æ ‡è®°



![[ä¸æ´»è·ƒä¸»é¢˜/æ•°æ®ç»“æ„ä¸ç®—æ³•/æŸ¥æ‰¾/_attachments/Pasted image 20221101022520.png]]



```cpp
// çº¿æ®µæ ‘çš„ç»“ç‚¹
struct Node {
	int left;		// åŒºé—´çš„å·¦è¾¹ç•Œ
    int right;		// åŒºé—´çš„å³è¾¹ç•Œ
    int sum;		// åŒºé—´å†…ç»“ç‚¹å€¼ä¹‹å’Œ
    int lazy;		// ä¿®æ”¹æ ‡è®°
};
// é€šè¿‡å­èŠ‚ç‚¹æ¥æ›´æ–°çˆ¶èŠ‚ç‚¹çš„å€¼
void PushUp(vector<Node>& S, int index_S) {
	S[index_S].sum = S[index_S << 1].sum + S[index_S << 1 + 1].sum;
}
// ä¸‹æ¨lazyæ ‡è®°
void PushDown(vector<Node>& S, int index_S) {
    if (S[index_S].lazy == 0 || S[index_S].left == S[index_S].right) {
   		return;
    }
	int lazy = S[index_S].lazy;
    int mid = (S[index_S].left + S[index_S].right) << 1;
    // å½“å‰ç»“ç‚¹lazyæ ‡è®°ç½®ä¸º0
    S[index_S].lazy = 0;
    // ä¿®æ”¹å·¦å­ç»“ç‚¹
    S[index_S << 1].sum += lazy * (mid - S[index_S].left + 1);
    S[index_S << 1].lazy += lazy;
    // ä¿®æ”¹å³å­ç»“ç‚¹
    S[index_S << 1 + 1].sum += lazy * (S[index_S].right - mid);
    S[index_S << 1 + 1].lazy += lazy;
}
```

##### çº¿æ®µæ ‘çš„æ„é€ $O(n)$

```cpp
void Build(vector<int> A, vector<Node>& S, int left, int right, int index_S) {
	if (left == right) {
    	S[index_S].sum = A[left];
        S[index_S].left = left;
        S[index_S].right = right;
        return;
    }
    int mid = (left + right) << 1;
    Build(A, S, left, mid, index_S << 1);
    Build(A, S, mid + 1, right, index_S << 1 + 1);
    PushUp();
}
Build(A, S, 1, n, 1);
```



##### å•ç‚¹ä¿®æ”¹$O(logn)$

```cpp
void UpdatePoint(vector<Node>& S, int index_S, int index_A, int value) {
	if (S[index_S].left == S[index_S].right) {
        S[index_S].sum = value;
        return;
	}
    PushDown(S, index_S);
    int mid = (S[index_S].left + S[index_S].right) << 1;
    if (index_A <= mid) {
    	UpdatePoint(S, index_S << 1, index_A, value);
    }
    else {
    	UpdatePoint(S, index_S << 1 + 1, index_A, value);
    }
    PushUp(S, index_S);
}
```



##### åŒºé—´ä¿®æ”¹$O(logn)$

åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ å¢åŠ ä¸€ä¸ªå€¼

```cpp

// å½“å‰åŒºé—´ç»“ç‚¹S[index_S]ä¸€å®šå’Œå¾…ä¿®æ”¹åŒºé—´[l, r]æœ‰äº¤é›†
void UpdateInterval(vector<Node>& S, int index_S, int l, int r, int delta) {
	if (l <= S[index_S].left && r >= S[index_S].right) {
    	S[index_S].lazy += delta;
        S[index_S].sum += delta * (S[index_S].right - S[index_S].left + 1);
        return;
    }
    PushDown(S, index_S);
    int mid = (S[index_S].left + S[index_S].right) << 1;
    if (l <= mid) UpdateInterval(S, index_S << 1, l, r, delta);
    if (r > mid) UpdateInterval(S, index_S << 1 + 1, l, r, delta);
    PushUp(S, index_S);
}
```

##### å•ç‚¹æŸ¥è¯¢ï¼š$O(logn)$

ç”±äºå­˜åœ¨lazyæ ‡è®°ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æŸ¥è¯¢åŸæ•°ç»„`A[n]`ã€‚å¤æ‚åº¦ä¸åŒºé—´æŸ¥è¯¢ç›¸åŒ



##### åŒºé—´æŸ¥è¯¢ï¼š$O(logn)$

```cpp
int IntervalSum(vector<Node>& S, int index_S, int l, int r) {
    if (l <= S[index_S].left && r >= S[index_S].right) {
    	return S[index_S].sum;
    }
    PushDown(S, index_S);
    int mid = (S[index_S].left + S[index_S].right) << 1;
    int sum = 0;
    if (l <= mid) {
    	sum += IntervalSum(S, index_S << 1, l, r);
    }
    if (r > mid) {
    	sum += IntervalSum(S, index_S << 1 + 1, l, r);
    }
    return sum;
}
```