
## CPU 和主存的连接方式
CPU 通过「数据总线」，「地址总线」和「控制总线」和主存连接：
![[不活跃主题/计算机组成原理/存储器/_attachments/1634042969003-70b9e49f-ac74-4b0d-8dc2-ffa8f12a401e.png | 567]]

**CPU 读数据**：将地址写入 `MAR`，通过「控制线」发送读的信号，在 `MDR` 中可以得到需要的数据
**CPU 写数据**：将地址写入 `MAR`，要写的内容放入 `MDR` 中，通过控制线发送写数据的信号


## 存储字长与编址
**编址方式**：存储器的编址方式有「按字编址」和「按字节编址」，表示「存储单元」的大小是多少。地址总线发过来的地址可以唯一指定一个「存储单元」

**字长**：「机器字长」是指整数运算一次可以处理的数据位数；「存储单元」的大小一般和「MDR」的大小相同，和「数据总线」的宽度相同。
（「存储字长」就是「存储单元」的大小。）

注：如果「按字编址」，CPU 也可以单独读取某个字节的内容，计算一下对应的「字」的地址即可。


## 主存容量的扩展

### 位扩展
位扩展是指增大「存储单元」的大小，相当于多个存储芯片「并联」在一起。

注：进行「位扩展」时，「片选」信号要**同时连接到所有芯片**，确保所有芯片都能接收到地址信息并输出数据。

位扩展的示意图：使用 8 个 `8K x 1` 的芯片得到 `8K x 8` 的芯片
![[不活跃主题/计算机组成原理/存储器/_attachments/1634124886898-53a542be-af30-4286-bf08-13d1cc0b95e9.png | 415]]


### 字扩展
字扩展不改变「存储单元」的大小，而是增加存储单元的数量。

使用地址的高位来选择某个芯片，需要「译码器」将高位地址转换为对应芯片的「片选」信号

字扩展的示意图：用 4 个 `16K x 8` 的芯片得到 `64K x 8` 的芯片
![[不活跃主题/计算机组成原理/存储器/_attachments/1634125119581-89526718-d42e-4bc9-ac70-f8d14425557d.png | 444]]


### 地址分配
进行「字扩展」时，地址空间的大小并没有改变，只是单个地址对应的「存储单元」大小增加了。
进行「位扩展」时，地址空间的大小发生了改变。

如何为「位扩展」的芯片分配地址空间：

- **线选法**：有 n 块芯片，就需要 n 根高位的地址线，当地址线的信息是 `0` 时，就选中对应的芯片。这种方法会导致地址空间不连续。
- **译码片选法**：有 n 块芯片，只需要 $\log _2 n$  根高位的地址线。需要专门的译码器来生成片选信号。


## 提高访存速度

### 双端口 RAM
存储器具有两个独立的端口，每个端口都有各自的地址线，数据线和读写控制线。
![[不活跃主题/计算机组成原理/存储器/_attachments/1634128442118-ba278337-735a-47d6-b9a6-8a5e1c6ed7d3.png | 345]]

访存：

- 两个端口同时访问不同的地址，不会冲突
- 两个端口的地址相同时，只要存在写操作，就会冲突。解决办法是：添加一个「忙」的信号，在进行写操作时，让某个端口暂时不可用。


### 单体多字存储器
考虑到程序执行具有「空间局部性」，CPU 一次可以处理一个「字」。让存储器一次可以读出多个字，可以增加总体的存取速度。

如图：给定一个地址后，一次可以从存储器中读出 4 个「字」，此后 CPU 可以慢慢处理这 4 个「字」
![[不活跃主题/计算机组成原理/存储器/_attachments/1634128600252-a9a19f1f-14b8-448e-b4f9-6ee17657d06e.png | 441]]

注：单体多字存储器只有一个存储体。


### 多体并行存储器
多体并行存储器有多个存储模块，每个模块都有独立的控制电路，地址寄存器和数据寄存器。

**高位交叉编址**：
地址的高位作为存储体的「体号」。这种方式会使得连续的数据位于同一块存储体上，可以增加存取操作的「并行性」。
例如：当 CPU 从某个存储器读取数据时，某个 IO 模块可以往另一个存储体中写入数据。
![[不活跃主题/计算机组成原理/存储器/_attachments/1634129129962-1b1e3062-5ecc-49c3-aeba-c9dfb29d2eda.png | 415]]

**低位交叉编址**：
地址的低位作为存储体的「体号」。这种方式使得连续的数据位于不同的存储体上，可以增加连续数据的存取速度。
![[不活跃主题/计算机组成原理/存储器/_attachments/1634128993642-58f7a5d0-c03b-4d4d-9540-a4b6d87da083.png | 352]]

假设每个存储体的访存时间为 $T$ ，总线的传输时间为 $r$ 。在访问连续数据时，可以每隔 $r$  就访问一个新的存储体：
![[不活跃主题/计算机组成原理/存储器/_attachments/1634129693068-c767e671-27bc-4638-8832-0b523087c400.png | 450]]

注：为了保证存储体可以连续工作，需要对存储体的数量做出限制：$m \ge \frac {T}{r}$ 

从整体，长期连续的状态来看，一个「存储周期」可以读取 $m$  个存储体中的数据；
仅考虑某一次的连续存储，所需的总时间，如上图所示，为：$t = T + (n - 1)r$ 





