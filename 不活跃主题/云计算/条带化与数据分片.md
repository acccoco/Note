> 
##### 摘要
> 本文介绍了aSAN中使用的条带化和分片技术
> - 条带化是RAID0的概念，可以提升存储的性能
> - 分片备份的基础

[toc]

#### 条带化与数据分片

##### 什么是数据分片和条带化：

- 数据分片：一个虚拟磁盘对应着 _aSAN_ 的一个 _qcow2_ 文件，_qcow2_ 文件会按照一定的方法被切分为固定大小的块，然后写入到磁盘中。

- 条带化：将一块连续的数据切分成很多小的数据块，并发地存储到不同的物理磁盘上。


##### 应用了条带化和分片后，数据写入的过程
假定：条带数为 _4_，条带深度为 _128K_

- 首先将连续的数据切分为固定大小的块（此处是 _128K_），每 _4_ 块组成一个条带组
- 一次并行写入一个条带组；对应的条带写入到分片组中对应的分片中。
- 当分片组被写满时（单个分片的大小上限假定为 _4GB_），条带会被写入到其他的分片组中

写入过程如图所示：
![[不活跃主题/云计算/_attachments/1600055500402-11c5ec03-257b-4652-ac11-1219a945bb9c.png ]]
注：
条带化和数据分片应该满足的关系：`条带组的条带数 = 分片组的分片数`
分片在磁盘中应该满足的原则：

- 分片组中的分片尽量跨磁盘组分布（可以充分利用磁盘组的 _SSD_）

- 如果分片组中的分片落入到同一个磁盘组，则应该跨磁盘分布，保证并发性能

