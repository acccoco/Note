

### web服务器和应用服务器
在开发中，一般将服务器分为web服务器和应用服务器。

- web服务器：解析客户端发来的http请求，将request和header等发送给应用服务器
- 应用服务器：接受web服务器发送过来的request和header，处理请求，返回response和header

用一张图来表示：
（其中：web服务器和应用服务器可以是两个进程，也可以是一个进程中的两个模块。web服务器和应用服务器之间的通信方式可以是unix socket，ip socket，也可以是方法调用）
![[不活跃主题/misc/_attachments/1604500366205-e8373079-3c8f-4ff8-bfc7-a9bf92f87841.png | 194]]


### 时代演变
从最开始的静态服务器，到后来的动态服务器，大致发生了如下的演变过程


#### 静态服务器
服务器的功能单一：返回对应的文件
![[不活跃主题/misc/_attachments/1604500795453-b2008522-9935-4d46-8bae-d660efd2da8d.png | 176]]


#### CGI时代
接收到请求后，web服务器通过fork的方式启动一个进程（叫做CGI进程），处理请求，处理完毕后将进程杀死。web服务器和CGI进程之间的通信方式是stdin和stdout
如下图所示：
![[不活跃主题/misc/_attachments/1604500670430-599ecb65-6332-4d2a-8cc8-ce16db205a0a.png | 249]]


#### FastCGI时代
CGI时代的弊端是fork，所以FastCGI使用进程池来处理请求，这些进程池统一由一个FastCGI进程来管理：
![[不活跃主题/misc/_attachments/1604501014520-b6337e1b-09cc-4243-abed-2696fa2d097b.png | 290]]


#### uWSGI
到后来，出现了各种各样的架构。以python的WSGI为例：
WSGI是一个协议，规定了web服务器和应用之间的通信方式
uWSGI是一个应用程序，它实现了WSGI协议
uwsgi是uWSGI这个应用程序独有的协议，传输更快


##### 使用uWSGI的一个例子
编写如下的 `python` 脚本：
```python
# app.py
def application(env, start_response):
    start_response('200 OK', [('Content-Type','text/html')])
    return [b"Hello World"]
```
然后执行命令： `uwsgi --http :9090 --wsgi-file app.py` ，服务器就运行起来了
服务器的运行关系如图：
（应用脚本就运行在 `uWSGI` 进程里面，暂不清楚怎么做到的）
![[不活跃主题/misc/_attachments/1604501606104-1f97478a-d965-4a6e-b5fb-75024b2e5f24.png | 223]]

Django实现的部分就是上图的 `application` 部分。
Django也可以直接作为服务器运行起来，那是因为Django里面有一个测试用的web服务器，性能较差
一般来说，由这种部署方式：
![[不活跃主题/misc/_attachments/1604502155989-12207a2c-3ea8-4260-a233-daf6df6b057e.png | 211]]
