[toc]

#### 文件的物理结构
一个文件由若干个逻辑块组成。
块，也就是文件系统的最小存储单位——簇。一个簇通常包含 $2^n$ 个逻辑扇区。
一个文件的块的组织形式，不同的文件系统有不同的实现。

##### 连续分配
文件存放于一片连续的磁盘区域上，只需要指定起始块号和文件长度，就能定位一个文件。
![[不活跃主题/操作系统/文件/_attachments/1600092885213-28c89755-4af7-41bc-93fd-9ae81765642d.png | 618]]

##### 链接分配
分为隐式链接方式和显式链接方式：
隐式链接分配：
![[不活跃主题/操作系统/文件/_attachments/1600092885261-225c9350-e251-4465-805f-e5b3da501221.png | 541]]
显式链接分配：（_FAT_ 文件系统就采用这种分配方式）
定位一个文件的物理块，除了需要查询相应的 _FCB_，还需要文件系统的文件分配表。
![[不活跃主题/操作系统/文件/_attachments/1600092885301-15183731-d332-40b9-bef9-525338c2fd6d.png | 803]]

##### 索引分配
链接索引分配
索引块存放着文件数据块的索引，索引块通过链接的形式组织起来，通过索引块可以找到文件的数据块。
![[不活跃主题/操作系统/文件/_attachments/1600092885349-91d1f473-cf50-4457-b7d4-97c8f3ffd212.png | 873]]
混合索引分配
索引块分了层级，这样可以在时间和空间上进行平衡。
![[不活跃主题/操作系统/文件/_attachments/1600092885379-fce38c75-2f4c-48f4-b27f-2dc901c9127c.png | 1132]]

#### ...

##### 磁盘分区

- 磁盘分区方式，有MBR和GPT等。它将物理盘划分为一个个卷/分区。有着如下关系：卷可以横跨多个物理盘；一个物理盘也可以包含多个卷。

- 每个盘的第一块，叫引导块，可以用来引导操作系统。


![[不活跃主题/操作系统/文件/_attachments/1600093189145-aed7aa0f-342e-4ce3-8409-b2edfeb2b66a.png | 462]]


##### 文件系统

- 文件系统建立在分区中，是对分区的管理办法，有FAT，NTFS，Ext等方式。
- 每个分区的第一块，叫做分区控制块。在UNIX系统中它又叫超级块，包括目录区/文件区的划分信息，并且作为第一个成组连接块管理着空闲块。

#### _MBR_ 
_MBR_ 是一种分区方式，主要有两方面的作用

- 为磁盘分区，为文件系统提供支持
- 为操作系统引导提供支持

_MBR_ 的局限性：

- 由于分区表只能有 _4_ 个表项，所以分区数量有限制
- 单个分区的最大大小只能有 _2TB_

##### _MBR_ 第一扇区的结构
_MBR_ 的第一个扇区起到了提纲挈领的作用
使用 _MBR_ 分区的磁盘，其第一个扇区的结构：
![[不活跃主题/操作系统/文件/_attachments/1600092885416-59e37ce3-35ab-4a20-83f2-6badd7dc72aa.png | 266]]
其中：

- _MBR_，主引导记录/引导加载程序，用于在计算机启动时引导操作系统。（在系统引导时，_BIOS_ 会将 _MBR_ 加载进内存中）
- _DPT_，磁盘分区表，记录了磁盘的分区信息，一共四条记录。
- 最后是固定的长度 _2_ 字节的结束标志

##### _MBR_ 主引导记录
_MBR_ 引导代码是操作系统引导的一个环节：
操作系统引导的过程大致如下：

1. _BIOS_ 将磁盘第一扇区读入内存，控制权转交给主引导记录 _MBR_
2. _MBR_ 负责找到磁盘分区表，并且加载某个分区的第一个扇区（_VBR_，卷引导记录），控制权转交给 _VBR_
3. _VBR_ 类似于 _MBR_ ，其作用是：从该卷中加载操作系统引导启动所需的文件。例如，_XP_ 系统的 _NTLDR_ 文件。

如图所示：
![[不活跃主题/操作系统/文件/_attachments/1600092885446-9ad61c71-20b2-4abd-b4e7-5a132961f9ac.png | 97]]

##### MBR分区表表项
记录结构如下：
![[不活跃主题/操作系统/文件/_attachments/1600092885474-ece3b509-bdbe-4e7e-b1af-b1a661a02c3a.png ]]
其中：

- 状态可以表示：该分区是否为活动分区，该分区是否激活
- 分区类型：可以指定寻址方式，是 _CHS_ 还是 _LBA_；还可以表示该分区使用何种文件系统
