---
tag: glsl, vulkan
---

### vulkan 的 memory layout

#### scalar alignment

规则：

- 长度为 `N`的标量，`alignment = N`
- 向量，数组的 `alignment`等于其元素的相同
- 矩阵视为向量的数组
- 结构体的 `alignment`取其成员的最大值

![[_attachments/image-21.png | 300]]

#### base alignment

（GLSL 的 `std430`满足这个规则）
> `vulkan`的 `push constant`是 `std430`的。

规则：在 scalar alignment 的基础上

- 有 3 或 4 个分量的向量，`alignment = 4N`（其中 `N`是标量组件的 `alignment`）
- 数组的 `alignment`等于其元素的 `alignment`

![[_attachments/image-22.png | 400]]


#### extended alignment

（GLSL 的 `std140`满足这个规则）
> 测试发现，在 `vulkan + spv`的情况下，`shader`中`uniform`的默认 `layout`与 `std140`一致。
> 为避免混淆，应该主动标注 `layout`


规则：

- 有 3 或 4 分量的向量，`alignment = 4N`
- 数组或结构体的 `alignment`应该是 `4N`，且数组元素的 `alignment = 4N`
- 矩阵视为数组

![[_attachments/image-23.png | 700]]


#### 数组
glsl 中，数组是连续存储的。

多维数组：`int[4][5] arr` 这样理解：
- `arr` 是一个长度为 `4` 的数组，数组元素类型是 `int[5]` 

示意图如下：
![[_attachments/glsl 多维数组示意图.svg]]